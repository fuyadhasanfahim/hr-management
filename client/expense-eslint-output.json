[{"filePath":"C:\\Users\\fuyad\\Codes\\Office\\hr-management\\client\\src\\app\\(root)\\expense\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ExpenseCategory' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useMemo } from \"react\";\r\nimport { useGetFinanceAnalyticsQuery } from \"@/redux/features/analytics/analyticsApi\";\r\nimport {\r\n    useGetExpensesQuery,\r\n    useGetExpenseStatsQuery,\r\n    useCreateExpenseMutation,\r\n    useUpdateExpenseMutation,\r\n    useDeleteExpenseMutation,\r\n    useGetExpenseCategoriesQuery,\r\n    useCreateExpenseCategoryMutation,\r\n    useGetExpenseYearsQuery,\r\n    type Expense,\r\n    type ExpenseCategory,\r\n    type ExpenseQueryParams,\r\n} from \"@/redux/features/expense/expenseApi\";\r\nimport { useGetAllBranchesQuery } from \"@/redux/features/branch/branchApi\";\r\nimport {\r\n    Card,\r\n    CardContent,\r\n    CardDescription,\r\n    CardHeader,\r\n    CardTitle,\r\n} from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from \"@/components/ui/table\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogFooter,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport {\r\n    Popover,\r\n    PopoverContent,\r\n    PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport {\r\n    Loader,\r\n    ChevronLeft,\r\n    ChevronRight,\r\n    Plus,\r\n    Trash2,\r\n    TrendingUp,\r\n    Calendar as CalendarIcon,\r\n    DollarSign,\r\n    BarChart3,\r\n    Edit2,\r\n    Filter,\r\n    Download,\r\n    RefreshCcw,\r\n} from \"lucide-react\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { toast } from \"sonner\";\r\nimport { format } from \"date-fns\";\r\nimport {\r\n    ExpenseForm,\r\n    type ExpenseFormData,\r\n} from \"@/components/expense/ExpenseForm\";\r\nimport { ExportExpenseDialog } from \"@/components/expense/ExportExpenseDialog\";\r\n\r\nconst statusOptions = [\r\n    {\r\n        value: \"pending\",\r\n        label: \"Pending\",\r\n        color: \"text-yellow-600 bg-yellow-100\",\r\n    },\r\n    { value: \"paid\", label: \"Paid\", color: \"text-green-600 bg-green-100\" },\r\n    {\r\n        value: \"partial_paid\",\r\n        label: \"Partial Paid\",\r\n        color: \"text-orange-600 bg-orange-100\",\r\n    },\r\n];\r\n\r\ntype FilterType = \"all\" | \"today\" | \"week\" | \"month\" | \"year\" | \"range\";\r\n\r\nconst MONTHS = [\r\n    { value: 1, label: \"January\" },\r\n    { value: 2, label: \"February\" },\r\n    { value: 3, label: \"March\" },\r\n    { value: 4, label: \"April\" },\r\n    { value: 5, label: \"May\" },\r\n    { value: 6, label: \"June\" },\r\n    { value: 7, label: \"July\" },\r\n    { value: 8, label: \"August\" },\r\n    { value: 9, label: \"September\" },\r\n    { value: 10, label: \"October\" },\r\n    { value: 11, label: \"November\" },\r\n    { value: 12, label: \"December\" },\r\n];\r\n\r\nconst currentYear = new Date().getFullYear();\r\n\r\ninterface Branch {\r\n    _id: string;\r\n    name: string;\r\n}\r\n\r\nexport default function ExpensePage() {\r\n    // Filter State\r\n    const [page, setPage] = useState(1);\r\n    const [limit, setLimit] = useState(10);\r\n    const [search, setSearch] = useState(\"\");\r\n    const [filterType, setFilterType] = useState<FilterType>(\"all\");\r\n    const [statusFilter, setStatusFilter] = useState<string>(\"all\");\r\n    const [branchFilter, setBranchFilter] = useState<string>(\"all\");\r\n    const [selectedMonth, setSelectedMonth] = useState(\r\n        new Date().getMonth() + 1,\r\n    );\r\n    const [selectedYear, setSelectedYear] = useState(currentYear);\r\n    const [dateRange, setDateRange] = useState<{ from?: Date; to?: Date }>({});\r\n\r\n    // Dialog states\r\n    const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\r\n    const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\r\n    const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\r\n    const [selectedExpense, setSelectedExpense] = useState<Expense | null>(\r\n        null,\r\n    );\r\n    const [isAddCategoryDialogOpen, setIsAddCategoryDialogOpen] =\r\n        useState(false);\r\n    const [newCategoryName, setNewCategoryName] = useState(\"\");\r\n    const [isExportDialogOpen, setIsExportDialogOpen] = useState(false);\r\n\r\n    // Default form values for edit\r\n    const [editDefaultValues, setEditDefaultValues] = useState<\r\n        ExpenseFormData | undefined\r\n    >(undefined);\r\n\r\n    // Construct Query Params\r\n    const queryParams = useMemo<ExpenseQueryParams>(() => {\r\n        const params: ExpenseQueryParams = {\r\n            page,\r\n            limit,\r\n            sortOrder: \"desc\", // Default sort\r\n        };\r\n\r\n        if (search) params.search = search;\r\n        if (statusFilter !== \"all\") params.status = statusFilter;\r\n        if (branchFilter !== \"all\") params.branchId = branchFilter;\r\n\r\n        switch (filterType) {\r\n            case \"today\":\r\n                params.filterType = \"today\";\r\n                break;\r\n            case \"week\":\r\n                params.filterType = \"week\";\r\n                break;\r\n            case \"month\":\r\n                params.filterType = \"month\";\r\n                params.month = selectedMonth;\r\n                params.year = selectedYear;\r\n                break;\r\n            case \"year\":\r\n                params.filterType = \"year\";\r\n                params.year = selectedYear;\r\n                break;\r\n            case \"range\":\r\n                if (dateRange.from) {\r\n                    params.filterType = \"range\";\r\n                    params.startDate = format(dateRange.from, \"yyyy-MM-dd\");\r\n                    if (dateRange.to) {\r\n                        params.endDate = format(dateRange.to, \"yyyy-MM-dd\");\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n\r\n        return params;\r\n    }, [\r\n        page,\r\n        limit,\r\n        search,\r\n        statusFilter,\r\n        branchFilter,\r\n        filterType,\r\n        selectedMonth,\r\n        selectedYear,\r\n        dateRange,\r\n    ]);\r\n\r\n    // Queries\r\n    const {\r\n        data: expenseData,\r\n        isLoading,\r\n        isFetching,\r\n    } = useGetExpensesQuery(queryParams);\r\n\r\n    // For stats, pass filters if selected\r\n    const statsParams = useMemo(() => {\r\n        const params: { branchId?: string; year?: number; month?: number } = {};\r\n\r\n        if (branchFilter !== \"all\") params.branchId = branchFilter;\r\n\r\n        if (filterType === \"month\") {\r\n            params.month = selectedMonth;\r\n            params.year = selectedYear;\r\n        } else if (filterType === \"year\") {\r\n            params.year = selectedYear;\r\n        }\r\n\r\n        return params;\r\n    }, [branchFilter, filterType, selectedMonth, selectedYear]);\r\n\r\n    const { data: stats, isLoading: isLoadingStats } =\r\n        useGetExpenseStatsQuery(statsParams);\r\n\r\n    const { data: categories } = useGetExpenseCategoriesQuery(undefined);\r\n    const { data: branchesData } = useGetAllBranchesQuery(undefined);\r\n    const { data: yearsData } = useGetExpenseYearsQuery(undefined);\r\n    const years =\r\n        yearsData && yearsData.length > 0\r\n            ? yearsData\r\n            : Array.from({ length: 5 }, (_, i) => currentYear - i);\r\n\r\n    // Mutations\r\n    const [createExpense, { isLoading: isCreating }] =\r\n        useCreateExpenseMutation();\r\n    const [updateExpense, { isLoading: isUpdating }] =\r\n        useUpdateExpenseMutation();\r\n    const [deleteExpense, { isLoading: isDeleting }] =\r\n        useDeleteExpenseMutation();\r\n    const [createCategory, { isLoading: isCreatingCategory }] =\r\n        useCreateExpenseCategoryMutation();\r\n\r\n    const expenses = expenseData?.expenses || [];\r\n    const pagination = expenseData?.pagination;\r\n    const branches: Branch[] = branchesData?.branches || [];\r\n\r\n    const { data: financeData } = useGetFinanceAnalyticsQuery({ months: 1 });\r\n    const finalAmount = financeData?.summary?.finalAmount || 0;\r\n\r\n    const handleCreateExpense = async (data: ExpenseFormData) => {\r\n        const expenseAmount = parseFloat(data.amount);\r\n\r\n        if (expenseAmount > finalAmount) {\r\n            const difference = expenseAmount - finalAmount;\r\n            toast.error(\r\n                `Please add ${formatCurrency(difference)} first, because the current amount is less than the expense.`,\r\n            );\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await createExpense({\r\n                ...data,\r\n                amount: expenseAmount,\r\n            }).unwrap();\r\n            toast.success(\"Expense created successfully\");\r\n            setIsAddDialogOpen(false);\r\n        } catch (error) {\r\n            toast.error(\r\n                (error as Error)?.message || \"Failed to create expense\",\r\n            );\r\n        }\r\n    };\r\n\r\n    const handleUpdateExpense = async (data: ExpenseFormData) => {\r\n        if (!selectedExpense) return;\r\n\r\n        const newExpenseAmount = parseFloat(data.amount);\r\n        const oldExpenseAmount = selectedExpense.amount;\r\n        const maxAllowed = finalAmount + oldExpenseAmount;\r\n\r\n        if (newExpenseAmount > maxAllowed) {\r\n            const difference = newExpenseAmount - maxAllowed;\r\n            toast.error(\r\n                `Please add ${formatCurrency(difference)} first, because the current amount is less than the expense.`,\r\n            );\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await updateExpense({\r\n                id: selectedExpense._id,\r\n                ...data,\r\n                amount: newExpenseAmount,\r\n            }).unwrap();\r\n            toast.success(\"Expense updated successfully\");\r\n            setIsEditDialogOpen(false);\r\n            setSelectedExpense(null);\r\n        } catch (error) {\r\n            toast.error(\r\n                (error as Error)?.message || \"Failed to update expense\",\r\n            );\r\n        }\r\n    };\r\n\r\n    const handleDeleteExpense = async () => {\r\n        if (!selectedExpense) return;\r\n        try {\r\n            await deleteExpense(selectedExpense._id).unwrap();\r\n            toast.success(\"Expense deleted successfully\");\r\n            setIsDeleteDialogOpen(false);\r\n            setSelectedExpense(null);\r\n        } catch (error) {\r\n            toast.error(\r\n                (error as Error)?.message || \"Failed to delete expense\",\r\n            );\r\n        }\r\n    };\r\n\r\n    const handleCreateCategory = async () => {\r\n        if (!newCategoryName.trim()) {\r\n            toast.error(\"Category name is required\");\r\n            return;\r\n        }\r\n        try {\r\n            await createCategory({ name: newCategoryName }).unwrap();\r\n            toast.success(\"Category created successfully\");\r\n            setIsAddCategoryDialogOpen(false);\r\n            setNewCategoryName(\"\");\r\n        } catch (error) {\r\n            toast.error(\r\n                (error as Error)?.message || \"Failed to create category\",\r\n            );\r\n        }\r\n    };\r\n\r\n    const openEditDialog = (expense: Expense) => {\r\n        setSelectedExpense(expense);\r\n        setEditDefaultValues({\r\n            date: new Date(expense.date),\r\n            title: expense.title,\r\n            categoryId: expense.category?._id || \"\",\r\n            branchId: expense.branch?._id || \"\",\r\n            amount: expense.amount.toString(),\r\n            status: expense.status,\r\n            note: expense.note || \"\",\r\n        });\r\n        setIsEditDialogOpen(true);\r\n    };\r\n\r\n    const formatCurrency = (amount: number) => {\r\n        return new Intl.NumberFormat(\"en-IN\", {\r\n            style: \"currency\",\r\n            currency: \"BDT\",\r\n            minimumFractionDigits: 0,\r\n        }).format(amount);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Stats Cards */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                {/* Today's Expense Card */}\r\n                <div className=\"group relative overflow-hidden rounded-2xl border bg-linear-to-br from-violet-500/10 via-card to-card p-5 transition-all duration-300 hover:shadow-xl hover:shadow-violet-500/5 hover:border-violet-500/30\">\r\n                    <div className=\"absolute -right-4 -top-4 h-20 w-20 rounded-full bg-violet-500/10 blur-2xl transition-all duration-300 group-hover:bg-violet-500/20\" />\r\n                    <div className=\"relative\">\r\n                        <div className=\"flex items-center justify-between mb-3\">\r\n                            <div className=\"flex h-10 w-10 items-center justify-center rounded-xl bg-violet-500/10 text-violet-500 transition-all duration-300 group-hover:scale-110 group-hover:bg-violet-500/20\">\r\n                                <CalendarIcon className=\"h-5 w-5\" />\r\n                            </div>\r\n                        </div>\r\n                        {isLoadingStats ? (\r\n                            <Skeleton className=\"h-8 w-24\" />\r\n                        ) : (\r\n                            <h3 className=\"text-3xl font-bold tracking-tight text-violet-600 dark:text-violet-400\">\r\n                                {formatCurrency(stats?.today || 0)}\r\n                            </h3>\r\n                        )}\r\n                        <p className=\"text-xs text-muted-foreground mt-1\">\r\n                            Today&apos;s Expense\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* This Month Card */}\r\n                <div className=\"group relative overflow-hidden rounded-2xl border bg-linear-to-br from-pink-500/10 via-card to-card p-5 transition-all duration-300 hover:shadow-xl hover:shadow-pink-500/5 hover:border-pink-500/30\">\r\n                    <div className=\"absolute -right-4 -top-4 h-20 w-20 rounded-full bg-pink-500/10 blur-2xl transition-all duration-300 group-hover:bg-pink-500/20\" />\r\n                    <div className=\"relative\">\r\n                        <div className=\"flex items-center justify-between mb-3\">\r\n                            <div className=\"flex h-10 w-10 items-center justify-center rounded-xl bg-pink-500/10 text-pink-500 transition-all duration-300 group-hover:scale-110 group-hover:bg-pink-500/20\">\r\n                                <TrendingUp className=\"h-5 w-5\" />\r\n                            </div>\r\n                        </div>\r\n                        {isLoadingStats ? (\r\n                            <Skeleton className=\"h-8 w-24\" />\r\n                        ) : (\r\n                            <h3 className=\"text-3xl font-bold tracking-tight text-pink-600 dark:text-pink-400\">\r\n                                {formatCurrency(stats?.thisMonth || 0)}\r\n                            </h3>\r\n                        )}\r\n                        <p className=\"text-xs text-muted-foreground mt-1\">\r\n                            This Month\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* This Year Card */}\r\n                <div className=\"group relative overflow-hidden rounded-2xl border bg-linear-to-br from-orange-500/10 via-card to-card p-5 transition-all duration-300 hover:shadow-xl hover:shadow-orange-500/5 hover:border-orange-500/30\">\r\n                    <div className=\"absolute -right-4 -top-4 h-20 w-20 rounded-full bg-orange-500/10 blur-2xl transition-all duration-300 group-hover:bg-orange-500/20\" />\r\n                    <div className=\"relative\">\r\n                        <div className=\"flex items-center justify-between mb-3\">\r\n                            <div className=\"flex h-10 w-10 items-center justify-center rounded-xl bg-orange-500/10 text-orange-500 transition-all duration-300 group-hover:scale-110 group-hover:bg-orange-500/20\">\r\n                                <DollarSign className=\"h-5 w-5\" />\r\n                            </div>\r\n                        </div>\r\n                        {isLoadingStats ? (\r\n                            <Skeleton className=\"h-8 w-24\" />\r\n                        ) : (\r\n                            <h3 className=\"text-3xl font-bold tracking-tight text-orange-600 dark:text-orange-400\">\r\n                                {formatCurrency(stats?.thisYear || 0)}\r\n                            </h3>\r\n                        )}\r\n                        <p className=\"text-xs text-muted-foreground mt-1\">\r\n                            This Year\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Avg Monthly Card */}\r\n                <div className=\"group relative overflow-hidden rounded-2xl border bg-linear-to-br from-emerald-500/10 via-card to-card p-5 transition-all duration-300 hover:shadow-xl hover:shadow-emerald-500/5 hover:border-emerald-500/30\">\r\n                    <div className=\"absolute -right-4 -top-4 h-20 w-20 rounded-full bg-emerald-500/10 blur-2xl transition-all duration-300 group-hover:bg-emerald-500/20\" />\r\n                    <div className=\"relative\">\r\n                        <div className=\"flex items-center justify-between mb-3\">\r\n                            <div className=\"flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-500/10 text-emerald-500 transition-all duration-300 group-hover:scale-110 group-hover:bg-emerald-500/20\">\r\n                                <BarChart3 className=\"h-5 w-5\" />\r\n                            </div>\r\n                        </div>\r\n                        {isLoadingStats ? (\r\n                            <Skeleton className=\"h-8 w-24\" />\r\n                        ) : (\r\n                            <h3 className=\"text-3xl font-bold tracking-tight text-emerald-600 dark:text-emerald-400\">\r\n                                {formatCurrency(stats?.avgMonthly || 0)}\r\n                            </h3>\r\n                        )}\r\n                        <p className=\"text-xs text-muted-foreground mt-1\">\r\n                            Avg Monthly\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Card */}\r\n            <Card>\r\n                <CardHeader className=\"flex flex-row items-center justify-between\">\r\n                    <div>\r\n                        <CardTitle className=\"text-2xl\">\r\n                            Expense Management\r\n                        </CardTitle>\r\n                        <CardDescription>\r\n                            Track and manage company expenses\r\n                        </CardDescription>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <Dialog>\r\n                            <Button\r\n                                onClick={() => setIsExportDialogOpen(true)}\r\n                                variant=\"outline\"\r\n                            >\r\n                                <Download className=\" h-4 w-4\" />\r\n                                Export\r\n                            </Button>\r\n                            <ExportExpenseDialog\r\n                                open={isExportDialogOpen}\r\n                                onOpenChange={setIsExportDialogOpen}\r\n                                availableYears={years}\r\n                            />\r\n                        </Dialog>\r\n                        <Dialog\r\n                            open={isAddDialogOpen}\r\n                            onOpenChange={setIsAddDialogOpen}\r\n                        >\r\n                            <DialogTrigger asChild>\r\n                                <Button>\r\n                                    <Plus className=\" h-4 w-4\" />\r\n                                    Add Expense\r\n                                </Button>\r\n                            </DialogTrigger>\r\n                            <DialogContent className=\"max-w-md\">\r\n                                <DialogHeader>\r\n                                    <DialogTitle>Add New Expense</DialogTitle>\r\n                                    <DialogDescription>\r\n                                        Fill in the details to add a new expense\r\n                                    </DialogDescription>\r\n                                </DialogHeader>\r\n                                <ExpenseForm\r\n                                    onSubmit={handleCreateExpense}\r\n                                    isSubmitting={isCreating}\r\n                                    categories={categories}\r\n                                    branches={branches}\r\n                                    onAddCategory={() =>\r\n                                        setIsAddCategoryDialogOpen(true)\r\n                                    }\r\n                                    submitLabel=\"Create\"\r\n                                    onCancel={() => setIsAddDialogOpen(false)}\r\n                                />\r\n                            </DialogContent>\r\n                        </Dialog>\r\n                    </div>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    {/* Filters Toolbar */}\r\n                    <div className=\"flex flex-wrap items-center gap-3 p-4 bg-muted/30 rounded-lg border border-border/50\">\r\n                        <div className=\"flex items-center gap-2 \">\r\n                            <div className=\"bg-primary/10 p-2 rounded-full\">\r\n                                <Filter className=\"h-4 w-4 text-primary\" />\r\n                            </div>\r\n                            <span className=\"text-sm font-medium\">\r\n                                Filters:\r\n                            </span>\r\n                        </div>\r\n\r\n                        {/* Search */}\r\n                        <Input\r\n                            placeholder=\"Search...\"\r\n                            value={search}\r\n                            onChange={(e) => {\r\n                                setSearch(e.target.value);\r\n                                setPage(1);\r\n                            }}\r\n                            className=\"w-[200px] h-9 bg-background/60\"\r\n                        />\r\n\r\n                        {/* Date Filter Type */}\r\n                        <Select\r\n                            value={filterType}\r\n                            onValueChange={(v) => {\r\n                                setFilterType(v as FilterType);\r\n                                setPage(1);\r\n                            }}\r\n                        >\r\n                            <SelectTrigger className=\"w-[140px] h-9 bg-background/60\">\r\n                                <SelectValue placeholder=\"Date Range\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                <SelectItem value=\"all\">All Time</SelectItem>\r\n                                <SelectItem value=\"today\">Today</SelectItem>\r\n                                <SelectItem value=\"week\">This Week</SelectItem>\r\n                                <SelectItem value=\"month\">Monthly</SelectItem>\r\n                                <SelectItem value=\"year\">Yearly</SelectItem>\r\n                                <SelectItem value=\"range\">Range</SelectItem>\r\n                            </SelectContent>\r\n                        </Select>\r\n\r\n                        {/* Contextual Date Filters */}\r\n                        {filterType === \"month\" && (\r\n                            <div className=\"flex gap-2 animate-in fade-in slide-in-from-left-2 duration-300\">\r\n                                <Select\r\n                                    value={selectedMonth.toString()}\r\n                                    onValueChange={(v) =>\r\n                                        setSelectedMonth(parseInt(v))\r\n                                    }\r\n                                >\r\n                                    <SelectTrigger className=\"w-[120px] h-9 bg-background/60\">\r\n                                        <SelectValue />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        {MONTHS.map((m) => (\r\n                                            <SelectItem\r\n                                                key={m.value}\r\n                                                value={m.value.toString()}\r\n                                            >\r\n                                                {m.label}\r\n                                            </SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                                <Select\r\n                                    value={selectedYear.toString()}\r\n                                    onValueChange={(v) =>\r\n                                        setSelectedYear(parseInt(v))\r\n                                    }\r\n                                >\r\n                                    <SelectTrigger className=\"w-[90px] h-9 bg-background/60\">\r\n                                        <SelectValue />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        {years.map((y: number) => (\r\n                                            <SelectItem\r\n                                                key={y}\r\n                                                value={y.toString()}\r\n                                            >\r\n                                                {y}\r\n                                            </SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                        )}\r\n\r\n                        {filterType === \"year\" && (\r\n                            <Select\r\n                                value={selectedYear.toString()}\r\n                                onValueChange={(v) =>\r\n                                    setSelectedYear(parseInt(v))\r\n                                }\r\n                            >\r\n                                <SelectTrigger className=\"w-[100px] h-9 bg-background/60 animate-in fade-in slide-in-from-left-2\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {years.map((y: number) => (\r\n                                        <SelectItem\r\n                                            key={y}\r\n                                            value={y.toString()}\r\n                                        >\r\n                                            {y}\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        )}\r\n\r\n                        {filterType === \"range\" && (\r\n                            <Popover>\r\n                                <PopoverTrigger asChild>\r\n                                    <Button\r\n                                        variant=\"outline\"\r\n                                        className=\"w-[240px] h-9 bg-background/60 justify-start text-left font-normal animate-in fade-in slide-in-from-left-2\"\r\n                                    >\r\n                                        <CalendarIcon className=\" h-4 w-4\" />\r\n                                        {dateRange.from ? (\r\n                                            dateRange.to ? (\r\n                                                <>\r\n                                                    {format(\r\n                                                        dateRange.from,\r\n                                                        \"MMM dd\",\r\n                                                    )}{\" \"}\r\n                                                    -{\" \"}\r\n                                                    {format(\r\n                                                        dateRange.to,\r\n                                                        \"MMM dd\",\r\n                                                    )}\r\n                                                </>\r\n                                            ) : (\r\n                                                format(dateRange.from, \"PPP\")\r\n                                            )\r\n                                        ) : (\r\n                                            \"Pick a date range\"\r\n                                        )}\r\n                                    </Button>\r\n                                </PopoverTrigger>\r\n                                <PopoverContent\r\n                                    className=\"w-auto p-0\"\r\n                                    align=\"start\"\r\n                                >\r\n                                    <Calendar\r\n                                        mode=\"range\"\r\n                                        selected={{\r\n                                            from: dateRange.from,\r\n                                            to: dateRange.to,\r\n                                        }}\r\n                                        onSelect={(range) =>\r\n                                            setDateRange({\r\n                                                from: range?.from,\r\n                                                to: range?.to,\r\n                                            })\r\n                                        }\r\n                                        numberOfMonths={2}\r\n                                    />\r\n                                </PopoverContent>\r\n                            </Popover>\r\n                        )}\r\n\r\n                        <div className=\"w-px h-6 bg-border mx-1\" />\r\n\r\n                        {/* Status Filter */}\r\n                        <Select\r\n                            value={statusFilter}\r\n                            onValueChange={(v) => {\r\n                                setStatusFilter(v);\r\n                                setPage(1);\r\n                            }}\r\n                        >\r\n                            <SelectTrigger className=\"w-[130px] h-9 bg-background/60\">\r\n                                <SelectValue placeholder=\"Status\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                <SelectItem value=\"all\">All Status</SelectItem>\r\n                                {statusOptions.map((opt) => (\r\n                                    <SelectItem\r\n                                        key={opt.value}\r\n                                        value={opt.value}\r\n                                    >\r\n                                        {opt.label}\r\n                                    </SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n\r\n                        {/* Branch Filter */}\r\n                        <Select\r\n                            value={branchFilter}\r\n                            onValueChange={(v) => {\r\n                                setBranchFilter(v);\r\n                                setPage(1);\r\n                            }}\r\n                        >\r\n                            <SelectTrigger className=\"w-[150px] h-9 bg-background/60\">\r\n                                <SelectValue placeholder=\"Branch\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                <SelectItem value=\"all\">\r\n                                    All Branches\r\n                                </SelectItem>\r\n                                {branches.map((branch) => (\r\n                                    <SelectItem\r\n                                        key={branch._id}\r\n                                        value={branch._id}\r\n                                    >\r\n                                        {branch.name}\r\n                                    </SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => {\r\n                                setSearch(\"\");\r\n                                setFilterType(\"all\");\r\n                                setStatusFilter(\"all\");\r\n                                setBranchFilter(\"all\");\r\n                                setPage(1);\r\n                                setDateRange({});\r\n                            }}\r\n                            className=\"ml-auto\"\r\n                        >\r\n                            Reset\r\n                        </Button>\r\n                    </div>\r\n\r\n                    {/* Table */}\r\n                    <div className=\"border rounded-md overflow-hidden\">\r\n                        {isLoading ? (\r\n                            <Table>\r\n                                <TableHeader>\r\n                                    <TableRow>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Date\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Title\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Category\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Branch\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Amount\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Status\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Note\r\n                                        </TableHead>\r\n                                        <TableHead className=\"text-center\">\r\n                                            Actions\r\n                                        </TableHead>\r\n                                    </TableRow>\r\n                                </TableHeader>\r\n                                <TableBody>\r\n                                    {[...Array(5)].map((_, i) => (\r\n                                        <TableRow key={i}>\r\n                                            <TableCell className=\"border-r\">\r\n                                                <Skeleton className=\"h-4 w-20\" />\r\n                                            </TableCell>\r\n                                            <TableCell className=\"border-r\">\r\n                                                <Skeleton className=\"h-4 w-32\" />\r\n                                            </TableCell>\r\n                                            <TableCell className=\"border-r\">\r\n                                                <Skeleton className=\"h-4 w-20\" />\r\n                                            </TableCell>\r\n                                            <TableCell className=\"border-r\">\r\n                                                <Skeleton className=\"h-4 w-20\" />\r\n                                            </TableCell>\r\n                                            <TableCell className=\"border-r\">\r\n                                                <Skeleton className=\"h-4 w-16 ml-auto\" />\r\n                                            </TableCell>\r\n                                            <TableCell className=\"border-r\">\r\n                                                <Skeleton className=\"h-6 w-16 rounded-full\" />\r\n                                            </TableCell>\r\n                                            <TableCell className=\"border-r\">\r\n                                                <Skeleton className=\"h-4 w-24\" />\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-right\">\r\n                                                <div className=\"flex justify-end gap-2\">\r\n                                                    <Skeleton className=\"h-8 w-8\" />\r\n                                                    <Skeleton className=\"h-8 w-8\" />\r\n                                                </div>\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    ))}\r\n                                </TableBody>\r\n                            </Table>\r\n                        ) : (\r\n                            <Table>\r\n                                <TableHeader>\r\n                                    <TableRow>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Date\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Title\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Category\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Branch\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Amount\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Status\r\n                                        </TableHead>\r\n                                        <TableHead className=\"border-r text-center\">\r\n                                            Note\r\n                                        </TableHead>\r\n                                        <TableHead className=\"text-center\">\r\n                                            Actions\r\n                                        </TableHead>\r\n                                    </TableRow>\r\n                                </TableHeader>\r\n                                <TableBody>\r\n                                    {expenses.length === 0 ? (\r\n                                        <TableRow>\r\n                                            <TableCell\r\n                                                colSpan={8}\r\n                                                className=\"text-center py-8 text-muted-foreground\"\r\n                                            >\r\n                                                No expenses found\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    ) : (\r\n                                        expenses.map((expense: Expense) => {\r\n                                            const statusOpt =\r\n                                                statusOptions.find(\r\n                                                    (s) =>\r\n                                                        s.value ===\r\n                                                        expense.status,\r\n                                                );\r\n                                            return (\r\n                                                <TableRow key={expense._id}>\r\n                                                    <TableCell className=\"border-r whitespace-nowrap\">\r\n                                                        {format(\r\n                                                            new Date(\r\n                                                                expense.date,\r\n                                                            ),\r\n                                                            \"PPP\",\r\n                                                        )}\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"font-medium border-r\">\r\n                                                        {expense.title}\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"border-r\">\r\n                                                        {expense.category\r\n                                                            ?.name || \"-\"}\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"border-r\">\r\n                                                        {expense.branch?.name ||\r\n                                                            \"-\"}\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"font-medium border-r text-right\">\r\n                                                        {formatCurrency(\r\n                                                            expense.amount,\r\n                                                        )}\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"border-r text-center\">\r\n                                                        <span\r\n                                                            className={`px-2 py-1 rounded-full text-xs font-medium ${statusOpt?.color}`}\r\n                                                        >\r\n                                                            {statusOpt?.label}\r\n                                                        </span>\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"max-w-[150px] truncate border-r\">\r\n                                                        {expense.note || \"-\"}\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"text-right\">\r\n                                                        <div className=\"flex items-center justify-end gap-2\">\r\n                                                            {expense.status ===\r\n                                                                \"paid\" && (\r\n                                                                <Button\r\n                                                                    variant=\"ghost\"\r\n                                                                    size=\"icon\"\r\n                                                                    onClick={() => {\r\n                                                                        setSelectedExpense(\r\n                                                                            expense,\r\n                                                                        );\r\n                                                                        handleUpdateExpense(\r\n                                                                            {\r\n                                                                                ...expense,\r\n                                                                                amount: expense.amount.toString(),\r\n                                                                                categoryId:\r\n                                                                                    expense\r\n                                                                                        .category\r\n                                                                                        ?._id ||\r\n                                                                                    \"\",\r\n                                                                                branchId:\r\n                                                                                    expense\r\n                                                                                        .branch\r\n                                                                                        ?._id ||\r\n                                                                                    \"\",\r\n                                                                                date: new Date(\r\n                                                                                    expense.date,\r\n                                                                                ),\r\n                                                                                status: \"pending\",\r\n                                                                            },\r\n                                                                        );\r\n                                                                    }}\r\n                                                                    title=\"Mark as Pending\"\r\n                                                                >\r\n                                                                    <RefreshCcw className=\"h-4 w-4 text-orange-500\" />\r\n                                                                </Button>\r\n                                                            )}\r\n                                                            <Button\r\n                                                                variant=\"ghost\"\r\n                                                                size=\"icon\"\r\n                                                                onClick={() =>\r\n                                                                    openEditDialog(\r\n                                                                        expense,\r\n                                                                    )\r\n                                                                }\r\n                                                            >\r\n                                                                <Edit2 className=\"h-4 w-4\" />\r\n                                                            </Button>\r\n                                                            <Button\r\n                                                                variant=\"ghost\"\r\n                                                                size=\"icon\"\r\n                                                                onClick={() => {\r\n                                                                    setSelectedExpense(\r\n                                                                        expense,\r\n                                                                    );\r\n                                                                    setIsDeleteDialogOpen(\r\n                                                                        true,\r\n                                                                    );\r\n                                                                }}\r\n                                                            >\r\n                                                                <Trash2 className=\"h-4 w-4 text-destructive\" />\r\n                                                            </Button>\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                </TableRow>\r\n                                            );\r\n                                        })\r\n                                    )}\r\n                                </TableBody>\r\n                            </Table>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Pagination */}\r\n                    {pagination && (\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-6\">\r\n                                <div className=\"text-sm text-muted-foreground\">\r\n                                    Page {pagination.page} of{\" \"}\r\n                                    {Math.max(1, pagination.pages)} (\r\n                                    {pagination.total} total)\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <p className=\"text-sm font-medium\">\r\n                                        Rows per page\r\n                                    </p>\r\n                                    <Select\r\n                                        value={`${limit}`}\r\n                                        onValueChange={(value) => {\r\n                                            setLimit(Number(value));\r\n                                            setPage(1);\r\n                                        }}\r\n                                    >\r\n                                        <SelectTrigger className=\"h-8 w-[70px]\">\r\n                                            <SelectValue placeholder={limit} />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent side=\"top\">\r\n                                            {[10, 20, 30, 40, 50].map(\r\n                                                (pageSize) => (\r\n                                                    <SelectItem\r\n                                                        key={pageSize}\r\n                                                        value={`${pageSize}`}\r\n                                                    >\r\n                                                        {pageSize}\r\n                                                    </SelectItem>\r\n                                                ),\r\n                                            )}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex gap-2\">\r\n                                <Button\r\n                                    variant=\"outline\"\r\n                                    size=\"sm\"\r\n                                    onClick={() =>\r\n                                        setPage((p) => Math.max(1, p - 1))\r\n                                    }\r\n                                    disabled={page === 1 || isFetching}\r\n                                >\r\n                                    <ChevronLeft className=\"h-4 w-4 \" />\r\n                                    Previous\r\n                                </Button>\r\n                                <Button\r\n                                    variant=\"outline\"\r\n                                    size=\"sm\"\r\n                                    onClick={() =>\r\n                                        setPage((p) =>\r\n                                            Math.min(pagination.pages, p + 1),\r\n                                        )\r\n                                    }\r\n                                    disabled={\r\n                                        page >= pagination.pages || isFetching\r\n                                    }\r\n                                >\r\n                                    Next\r\n                                    <ChevronRight className=\"h-4 w-4 ml-2\" />\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Edit Dialog */}\r\n            <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\r\n                <DialogContent className=\"max-w-md\">\r\n                    <DialogHeader>\r\n                        <DialogTitle>Edit Expense</DialogTitle>\r\n                        <DialogDescription>\r\n                            Update the expense details\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n                    {editDefaultValues && (\r\n                        <ExpenseForm\r\n                            key={selectedExpense?._id}\r\n                            defaultValues={editDefaultValues}\r\n                            onSubmit={handleUpdateExpense}\r\n                            isSubmitting={isUpdating}\r\n                            categories={categories}\r\n                            branches={branches}\r\n                            onAddCategory={() =>\r\n                                setIsAddCategoryDialogOpen(true)\r\n                            }\r\n                            submitLabel=\"Update\"\r\n                            onCancel={() => setIsEditDialogOpen(false)}\r\n                        />\r\n                    )}\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Delete Confirmation */}\r\n            <AlertDialog\r\n                open={isDeleteDialogOpen}\r\n                onOpenChange={setIsDeleteDialogOpen}\r\n            >\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Delete Expense</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            Are you sure you want to delete this expense? This\r\n                            action cannot be undone.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={handleDeleteExpense}\r\n                            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n                            disabled={isDeleting}\r\n                        >\r\n                            {isDeleting && (\r\n                                <Loader className=\"h-4 w-4  animate-spin\" />\r\n                            )}\r\n                            Delete\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Add Category Dialog */}\r\n            <Dialog\r\n                open={isAddCategoryDialogOpen}\r\n                onOpenChange={setIsAddCategoryDialogOpen}\r\n            >\r\n                <DialogContent className=\"max-w-sm\">\r\n                    <DialogHeader>\r\n                        <DialogTitle>Add New Category</DialogTitle>\r\n                        <DialogDescription>\r\n                            Create a new expense category\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n                    <div className=\"grid gap-4 py-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"category-name\">\r\n                                Category Name *\r\n                            </Label>\r\n                            <Input\r\n                                id=\"category-name\"\r\n                                placeholder=\"e.g. Office Supplies\"\r\n                                value={newCategoryName}\r\n                                onChange={(e) =>\r\n                                    setNewCategoryName(e.target.value)\r\n                                }\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <DialogFooter>\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            onClick={() => setIsAddCategoryDialogOpen(false)}\r\n                        >\r\n                            Cancel\r\n                        </Button>\r\n                        <Button\r\n                            onClick={handleCreateCategory}\r\n                            disabled={isCreatingCategory}\r\n                        >\r\n                            {isCreatingCategory && (\r\n                                <Loader className=\"h-4 w-4  animate-spin\" />\r\n                            )}\r\n                            Create\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]}]
